## Context

MCP-серверы индексируют данные из примонтированных каталогов (выгрузка конфигурации, отчёт по конфигурации, справка БСП). Индексация — ресурсоёмкий процесс (часы). Сейчас при обновлении конфигурации нужно:
1. Вручную экспортировать конфигурацию из 1С
2. Перезапустить контейнеры с `RESET_DATABASE=true`
3. Ждать полной переиндексации

Расширения конфигурации — дополнительные модули, которые 1С экспортирует в отдельные каталоги. Серверы не знают о расширениях — они индексируют только основную конфигурацию из `CODE_PATH`.

**Текущие возможности серверов:**
- `RESET_DATABASE=true/false` — полная переиндексация или пропуск
- `AUTO_UPDATE_ON_STARTUP=true` — graph server проверяет обновления при старте
- CloudEmbeddingsServer имеет MCP-инструмент `reindex` для программной переиндексации
- Инкрементальное обновление НЕ поддерживается ни одним сервером

## Goals / Non-Goals

**Goals:**
- Создать скрипт `reindex.sh`, который управляет переиндексацией серверов с выбором режима и набора серверов
- Выяснить и задокументировать, как экспортировать расширения и подключить их к серверам
- Настроить volume mounts для каталогов расширений в docker-compose
- Протестировать на alcor с реальными расширениями (если есть)

**Non-Goals:**
- Инкрементальное обновление (серверы не поддерживают)
- Автоматический экспорт из 1С (требует доступ к базе 1С)
- CI/CD пайплайн для обновления

## Decisions

### 1. Скрипт reindex.sh вместо модификации start.sh
Переиндексация — отдельная операция, не связанная с обычным стартом/рестартом. Отдельный скрипт позволяет выбирать серверы и режим. start.sh всегда запускает с `RESET_DATABASE=false` (безопасно).

**Альтернатива**: параметры в start.sh (--reindex) — отвергнуто, т.к. усложняет скрипт и создаёт риск случайной переиндексации.

### 2. Расширения через объединённый каталог CODE_PATH
Расширения в 1С экспортируются в отдельные каталоги (по одному на расширение). Варианты:
- **A) Объединить в один каталог** с основной конфигурацией — серверы проиндексируют всё
- **B) Дополнительные volume mounts** для каждого расширения — требует изменения compose для каждого расширения

Выбран **вариант A**: пользователь копирует экспорт расширений в подкаталог рядом с основной конфигурацией. Серверы (CodeMetadata, CloudEmbeddings, Graph) автоматически индексируют весь каталог рекурсивно. Добавим переменную `EXTENSIONS_PATH` и второй volume mount.

### 3. Не все серверы требуют переиндексации при обновлении конфигурации
- **Нужна переиндексация**: CodeMetadata/CloudEmbeddings (код), Graph (метаданные), HelpSearch (только при обновлении платформы)
- **Не нужна**: SSL (зависит от версии БСП), SyntaxCheck (без индексов), CodeChecker (без индексов), Forms (зависит от конфигурации форм)
- Templates — только при изменении шаблонов

## Risks / Trade-offs

- **Переиндексация занимает часы** → скрипт показывает прогресс и позволяет выбрать только нужные серверы
- **Расширения могут конфликтовать с основной конфигурацией** → документировать, что файлы расширений должны быть в отдельных подкаталогах
- **Не все серверы поддерживают несколько source paths** → нужно тестировать, видит ли сервер файлы из подкаталогов

## Open Questions

- Есть ли на alcor реальные расширения конфигурации для тестирования?
- Поддерживает ли Graph server `METADATA_FILES` с вложенными каталогами расширений?
